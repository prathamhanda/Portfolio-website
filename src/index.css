@import url('https://fonts.cdnfonts.com/css/sf-pro-display');

@tailwind base;
@tailwind components;
@tailwind utilities;

/* Definition of the design system. All colors, gradients, fonts, etc should be defined here. 
All colors MUST be HSL.
*/

@layer base {
  :root {
    --background: 220 40% 98%;
    --foreground: 0 0% 5%;

    --card: 0 0% 100%;
    --card-foreground: 0 0% 5%;

    --popover: 0 0% 100%;
    --popover-foreground: 0 0% 5%;

    --primary: 0 0% 5%;
    --primary-foreground: 0 0% 98%;

    --secondary: 220 15% 94%;
    --secondary-foreground: 0 0% 5%;

    --muted: 220 20% 94%;
    --muted-foreground: 0 0% 40%;

    --accent: 220 60% 55%;
    --accent-foreground: 0 0% 98%;

    --destructive: 0 84% 60%;
    --destructive-foreground: 0 0% 98%;

    --border: 220 15% 88%;
    --input: 220 15% 88%;
    --ring: 0 0% 5%;

    --radius: 1rem;

    /* Gradient colors */
    --gradient-start: 210 100% 95%;
    --gradient-mid: 240 60% 95%;
    --gradient-end: 45 100% 92%;
    
    /* Decorative */
    --dot-primary: 210 100% 70%;
    --dot-secondary: 280 60% 70%;
    --dot-accent: 45 100% 70%;
    
    /* Glass effect */
    --glass-bg: 0 0% 100% / 0.6;
    --glass-border: 0 0% 100% / 0.2;
  }

  .dark {
    --background: 222 25% 12%;
    --foreground: 0 0% 96%;

    --card: 222 20% 16%;
    --card-foreground: 0 0% 96%;

    --popover: 222 20% 16%;
    --popover-foreground: 0 0% 96%;

    --primary: 0 0% 96%;
    --primary-foreground: 0 0% 8%;

    --secondary: 222 18% 20%;
    --secondary-foreground: 0 0% 96%;

    --muted: 222 18% 20%;
    --muted-foreground: 0 0% 68%;

    --accent: 220 70% 65%;
    --accent-foreground: 0 0% 8%;

    --destructive: 0 62% 50%;
    --destructive-foreground: 0 0% 96%;

    --border: 222 15% 25%;
    --input: 222 15% 25%;
    --ring: 0 0% 96%;
    
    /* Dark gradient colors */
    --gradient-start: 222 28% 14%;
    --gradient-mid: 230 25% 16%;
    --gradient-end: 222 28% 14%;
    
    /* Glass effect for dark mode */
    --glass-bg: 222 20% 16% / 0.7;
    --glass-border: 0 0% 100% / 0.15;
  }
}

@layer base {
  * {
    @apply border-border;
  }

  html {
    scroll-behavior: smooth;
    position: relative;
    /* prevent accidental horizontal scrolling from background overlays */
    overflow-x: hidden;
  }

  /* Grid overlay on elements that use the background color (shows above the bg but below content) */
  .bg-background {
    position: relative; /* ensure pseudo-element is positioned relative to this container */
    overflow: visible;
  }

  .bg-background::before {
    content: '';
    position: absolute;
    inset: 0;
    pointer-events: none;
  z-index: 0; /* keep the pseudo BG behind content */
    background-image: 
      linear-gradient(rgba(100, 150, 200, 0.06) 1px, transparent 1px),
      linear-gradient(90deg, rgba(100, 150, 200, 0.06) 1px, transparent 1px);
    background-size: 40px 40px;
    opacity: 1;
    mix-blend-mode: normal;
  }

  .dark .bg-background::before {
    background-image: 
      linear-gradient(rgba(150, 200, 255, 0.04) 1px, transparent 1px),
      linear-gradient(90deg, rgba(150, 200, 255, 0.04) 1px, transparent 1px);
  }

  body {
    @apply bg-background text-foreground;
    font-family: 'SF Pro Display', 'SF Pro Text', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    position: relative;
    margin: 0;
    padding: 0;
    /* ensure body doesn't produce horizontal scrollbar */
    overflow-x: hidden;
  }

  /* Ensure root div sits above grid overlay but grid still shows through */
  #root {
    position: relative;
    z-index: 100; /* Well above grid */
  }

  /* Gradient background */
  .gradient-bg {
    background: linear-gradient(
      180deg,
      hsl(var(--gradient-start)) 0%,
      hsl(var(--gradient-mid)) 50%,
      hsl(var(--gradient-end)) 100%
    );
  }

  /* Glass effect with hover tilt */
  .glass-card {
    background: hsl(var(--glass-bg));
    backdrop-filter: blur(12px);
    border: 1px solid hsl(var(--glass-border));
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .glass-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
  }

  /* Scroll fade-in animation */
  @keyframes fadeInUp {
    0% {
      opacity: 0;
      transform: translateY(40px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .scroll-animate {
    opacity: 0;
    animation: fadeInUp 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  }

  .scroll-animate-delay-1 {
    animation-delay: 0.15s;
  }

  .scroll-animate-delay-2 {
    animation-delay: 0.3s;
  }

  .scroll-animate-delay-3 {
    animation-delay: 0.45s;
  }
  
  .scroll-animate-delay-4 {
    animation-delay: 0.6s;
  }

  /* Slide-up animation used for mobile bottom-sheet */
  @keyframes slideUp {
    from { transform: translateY(18%); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .animate-slide-up {
    animation: slideUp 260ms cubic-bezier(.2,.8,.2,1) both;
  }

  /* Mobile-specific faster float animation (fallback/direct override) */
  @keyframes floatMobile {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-20px); }
  }

  /* Force a snappier float on narrow viewports regardless of Tailwind rebuild state */
  @media (max-width: 767px) {
    .animate-float-sm {
      animation: floatMobile 0.9s ease-in-out infinite !important;
    }
  }

  /* Utility class for subtle grid background */
  .grid-bg {
    background-color: hsl(var(--background));
    background-image: 
      linear-gradient(rgba(0, 0, 0, 0.15) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0, 0, 0, 0.15) 1px, transparent 1px);
    background-size: 24px 24px;
  }

  .dark .grid-bg {
    background-color: hsl(var(--background));
    background-image: 
      linear-gradient(rgba(255, 255, 255, 0.08) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.08) 1px, transparent 1px);
    background-size: 24px 24px;
  }

  /* Explicit overlay element used inside main background containers */
  .grid-overlay {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 0; /* keep the grid visually behind UI elements */
    background-image: 
      linear-gradient(rgba(100,150,200,0.06) 1px, transparent 1px),
      linear-gradient(90deg, rgba(100,150,200,0.06) 1px, transparent 1px);
    background-size: 40px 40px;
    opacity: 1;
    /* prevent overlay from contributing to overflow */
    background-clip: padding-box;
    transform: translateZ(0);
  }

  .dark .grid-overlay {
    background-image: 
      linear-gradient(rgba(150,200,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(150,200,255,0.03) 1px, transparent 1px);
    opacity: 0.75; /* slightly reduced opacity in dark so overlays don't compete visually */
    z-index: 0;
  }

  /* Ensure glass-style cards render above the grid overlay */
  .glass-card {
    position: relative; /* create stacking context */
    z-index: 20; /* above .grid-overlay (z-1) and below explicit overlays like tooltips (z-50) */
  }


}

/* Performance override for mobile bottom-sheet entrance
   Use a GPU-accelerated translate3d animation, set transform-origin to center bottom
   and hint the browser to only animate transform/opacity to avoid layout thrashing.
*/
@layer utilities {
  @keyframes sheet-slide-up-fast {
    from {
      transform: translate3d(0, 100%, 0);
      opacity: 0;
    }
    to {
      transform: translate3d(0, 0, 0);
      opacity: 1;
    }
  }

  /* Target both the plugin class and common Radix/Shadcn data-state classes */
  .slide-in-from-bottom-full,
  [data-state="open"].slide-in-from-bottom,
  [data-state="open"]\:slide-in-from-bottom {
    transform-origin: center bottom !important;
    backface-visibility: hidden !important;
    will-change: transform, opacity !important;
    animation-name: sheet-slide-up-fast !important;
    animation-duration: 260ms !important;
    animation-timing-function: cubic-bezier(.2, .8, .2, 1) !important;
    animation-fill-mode: both !important;
  }

  /* Make overlay fade less expensive during entrance by only animating opacity */
  .fixed.inset-0.z-\[100\].bg-black\/80,
  .fixed.inset-0.z-50.bg-black\/80 {
    will-change: opacity !important;
    backface-visibility: hidden !important;
  }
}

/* While sheet is animating we reduce expensive visual effects to avoid jank */
body.sheet-animating {
  /* hint to the browser */
  will-change: transform, opacity !important;
}

/* reduce overlay effects while animating (remove backdrop-filter/blurs) */
body.sheet-animating .fixed.inset-0.bg-black\/80,
body.sheet-animating .fixed.inset-0.z-50.bg-black\/80 {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  opacity: 0.85 !important; /* slightly lower to avoid repaint spikes */
}

/* reduce box-shadow and force compositing for the sheet content while animating */
body.sheet-animating [data-sheet-content] {
  box-shadow: 0 8px 24px rgba(0,0,0,0.12) !important;
  transition: box-shadow 160ms linear !important;
  transform: translateZ(0) !important;
  will-change: transform, opacity !important;
  contain: paint !important;
}

/* restore full shadow after animation (small safe default) */
[data-sheet-content] {
  -webkit-transform: translateZ(0);
}

/* Mobile Command Palette Improvements */
@media (max-width: 640px) {
  /* Ensure proper scrolling behavior on mobile */
  .mobile-command-content {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
    /* Prevent awkward resizing during keyboard transitions */
    transition: max-height 0.2s ease-out, bottom 0.2s ease-out;
  }
  
  /* Prevent zoom on input focus on iOS */
  input[type="text"], input[type="search"], textarea {
    font-size: 16px !important;
  }
  
  /* Improve touch scrolling for command list */
  [data-radix-command-list] {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
    /* Allow the command list to take full available height */
    max-height: none !important;
    flex: 1;
  }
  
  /* Ensure the dialog stays above virtual keyboard */
  [data-radix-dialog-content] {
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
  }
  
  /* Override Command component styles for mobile */
  [data-cmdk-root] {
    height: 100% !important;
    display: flex !important;
    flex-direction: column !important;
  }
}

/* Better support for viewport units that respect virtual keyboard */
@supports (height: 100dvh) {
  @media (max-width: 640px) {
    .mobile-dialog-height {
      max-height: 92dvh;
    }
  }
}
